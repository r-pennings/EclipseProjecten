import java.util.Scanner;

public class Main {

	public static final boolean CHEAT = true;

	public static void main(String[] args) {

		System.out.println("Welkom bij het spelletje Zeeslag!");
		System.out.println();
		System.out.println(
				"Probeer de oorlogsbodems van je tegenstander tot zinken te brengen voor hij jouw boten te pakken heeft genomen.");
		System.out.println();

		initGame();
	}

	/**
	 * Initializes the game. When game is finished, handle the answer for a new
	 * game.
	 */
	private static void initGame() {
		SeaBattle battle = new SeaBattle();

		Player[] players = askAmountOfPlayers();
		battle.setPlayers(players);

		// Play as long as no one has won.
		battle.play();

		boolean isNewGame = askForNewGame();
		if (!isNewGame) {
			System.out.println("Bedankt voor het spelen van het spelletje Zeeslag.");
			System.out.println("Hopelijk tot een volgende keer!");
			System.exit(0);
		} else {
			initGame();
		}
	}

	/**
	 * Asks how many players are going to play the game.
	 * 
	 * @return Player[] players;
	 */
	private static Player[] askAmountOfPlayers() {
		@SuppressWarnings("resource")
		Scanner sc = new Scanner(System.in);

		while (true) {
			System.out.print("Geef aantal spelers (1/2): ");
			String input = sc.nextLine();

			switch (input) {
			case "1":
				return askPlayerNames(1);
			case "2":
				return askPlayerNames(2);
			default:
				System.out.println("*** Dat is geen geldig aantal spelers! ***");
				continue;
			}
		}
	}

	/**
	 * Asks every player their name. The name should only contain characters and
	 * spaces.
	 * 
	 * @param amountOfPlayers
	 * @return Player[] players;
	 */
	private static Player[] askPlayerNames(int amountOfPlayers) {
		Player[] players = new Player[amountOfPlayers];

		for (int i = 0; i < amountOfPlayers; i++) {
			@SuppressWarnings("resource")
			Scanner sc = new Scanner(System.in);

			while (true) {
				System.out.print("Geef de naam van speler " + (i + 1) + ": ");

				String name = sc.nextLine();
				if (isValidName(name)) {
					players[i] = new Player(name);
					break;
				} else {
					System.out.println("*** Dat is geen geldige spelersnaam! ***");
					continue;
				}
			}

			players[i].setField(new Field());
		}

		System.out.println();

		return players;
	}

	/**
	 * Asks if player wants to play a new game of BattleShips. If not, shut down.
	 * 
	 * @return boolean isNewGame
	 */
	private static boolean askForNewGame() {
		@SuppressWarnings("resource")
		Scanner sc = new Scanner(System.in);

		while (true) {
			System.out.println();
			System.out.print("Wil je nog een keer spelen (ja/nee)? ");

			String input = sc.nextLine();

			switch (input) {
			case "ja":
				return true;
			case "nee":
				return false;
			default:
				System.out.println("*** Dat is geen geldig antwoord! ***");
				continue;
			}
		}
	}

	public static boolean isValidName(String name) {
		return (!name.isEmpty() && name.matches("^[a-zA-Z ]*$"));
	}
}
